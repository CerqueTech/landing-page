<!doctype html>
<html lang="es" class="dark">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" href="%sveltekit.assets%/favicon.png" />
		<link rel="apple-touch-icon" href="%sveltekit.assets%/favicon.png" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<meta name="theme-color" content="#7C3AED" media="(prefers-color-scheme: dark)" />
		<meta name="theme-color" content="#ffffff" media="(prefers-color-scheme: light)" />
		<meta name="robots" content="index, follow" />
		<meta name="author" content="CerqueTech Solutions" />
		<!-- Fonts are self-hosted via @fontsource (no external requests needed) -->
		<script>
			(function () {
				var theme = localStorage.getItem('theme');
				var isDark = theme !== 'light';
				if (isDark) {
					document.documentElement.classList.add('dark');
				} else {
					document.documentElement.classList.remove('dark');
				}
				// Preload only the correct globe texture for current theme
				var link = document.createElement('link');
				link.rel = 'preload';
				link.as = 'image';
				link.href = isDark ? '/images/globe/earth-night.webp' : '/images/globe/earth-blue-marble.webp';
				document.head.appendChild(link);
			})();
		</script>
		%sveltekit.head%
	</head>
	<body data-sveltekit-preload-data="hover">
		<!-- Full-page loading screen: Floating Lines -->
		<div id="app-loader" style="position:fixed;inset:0;z-index:9999;display:flex;align-items:center;justify-content:center;background:#09090b;transition:opacity 0.6s cubic-bezier(0.4,0,0.2,1);">
			<canvas id="loader-canvas" style="position:absolute;inset:0;width:100%;height:100%;"></canvas>
			<!-- Logo -->
			<img src="/images/logo/favicon.png" alt="" width="48" height="48" style="position:relative;z-index:1;animation:logo-in 0.8s cubic-bezier(0,0,0.2,1) both,logo-float 4s cubic-bezier(0.4,0,0.6,1) 0.8s infinite;filter:drop-shadow(0 0 24px rgba(168,85,247,0.5));" />
			<style>
				@keyframes logo-in{from{opacity:0;transform:scale(0.8)}to{opacity:1;transform:scale(1)}}
				@keyframes logo-float{
					0%,100%{transform:translateY(0)}
					50%{transform:translateY(-4px)}
				}
				html:not(.dark) #app-loader{background:#ffffff}
			</style>
			<script>
				(function(){
					var canvas = document.getElementById('loader-canvas');
					if (!canvas) return;
					var gl = canvas.getContext('webgl', { alpha: false, antialias: true });
					if (!gl) return;

					var isDark = document.documentElement.classList.contains('dark');

					// Resize
					function resize() {
						var dpr = Math.min(window.devicePixelRatio || 1, 2);
						canvas.width = canvas.clientWidth * dpr;
						canvas.height = canvas.clientHeight * dpr;
						gl.viewport(0, 0, canvas.width, canvas.height);
					}
					resize();
					window.addEventListener('resize', resize);

					// Mouse tracking
					var mouse = { x: 0.5, y: 0.5 };
					document.addEventListener('mousemove', function(e) {
						mouse.x = e.clientX / window.innerWidth;
						mouse.y = e.clientY / window.innerHeight;
					});

					// Shaders
					var vertSrc = 'attribute vec2 a_position;void main(){gl_Position=vec4(a_position,0.0,1.0);}';

					var fragSrc = [
						'precision mediump float;',
						'uniform float u_time;',
						'uniform vec2 u_resolution;',
						'uniform vec2 u_mouse;',
						'uniform float u_isDark;',

						// Wave function
						'float wave(float x, float freq, float speed, float amp, float phase) {',
						'  return sin(x * freq + u_time * speed + phase) * amp;',
						'}',

						// Smooth line SDF
						'float line(vec2 uv, float y, float thickness) {',
						'  return smoothstep(thickness, 0.0, abs(uv.y - y));',
						'}',

						'void main() {',
						'  vec2 uv = gl_FragCoord.xy / u_resolution;',
						'  float aspect = u_resolution.x / u_resolution.y;',
						'  uv.x *= aspect;',

						// Background
						'  vec3 bg = u_isDark > 0.5 ? vec3(0.035, 0.035, 0.043) : vec3(1.0);',
						'  vec3 col = bg;',

						// Mouse influence
						'  float mx = u_mouse.x * aspect;',
						'  float my = 1.0 - u_mouse.y;',

						// Dark mode colors (purples)
						'  vec3 c1d = vec3(0.486, 0.227, 0.929);',  // #7C3AED
						'  vec3 c2d = vec3(0.659, 0.333, 0.969);',  // #A855F7
						'  vec3 c3d = vec3(0.753, 0.518, 0.988);',  // #C084FC

						// Light mode colors (softer purples)
						'  vec3 c1l = vec3(0.486, 0.227, 0.929) * 0.7;',
						'  vec3 c2l = vec3(0.659, 0.333, 0.969) * 0.7;',
						'  vec3 c3l = vec3(0.753, 0.518, 0.988) * 0.7;',

						'  vec3 c1 = u_isDark > 0.5 ? c1d : c1l;',
						'  vec3 c2 = u_isDark > 0.5 ? c2d : c2l;',
						'  vec3 c3 = u_isDark > 0.5 ? c3d : c3l;',

						// Line opacity
						'  float baseAlpha = u_isDark > 0.5 ? 0.35 : 0.25;',

						// Mouse bend factor
						'  float bend = 0.0;',

						// Top wave group
						'  for (float i = 0.0; i < 5.0; i++) {',
						'    float phase = i * 1.2;',
						'    float baseY = 0.75 + i * 0.025;',
						'    float dist = length(vec2(uv.x - mx, baseY - my));',
						'    bend = 0.08 * exp(-dist * 3.0);',
						'    float y = baseY + wave(uv.x, 2.0 + i * 0.3, 0.4 + i * 0.05, 0.03 + i * 0.005, phase) + bend;',
						'    float l = line(uv, y, 0.004 - i * 0.0004);',
						'    float fade = smoothstep(0.0, 0.3, uv.x) * smoothstep(aspect, aspect - 0.3, uv.x);',
						'    col += c1 * l * baseAlpha * fade * (1.0 - i * 0.15);',
						'  }',

						// Middle wave group
						'  for (float i = 0.0; i < 6.0; i++) {',
						'    float phase = i * 0.9 + 3.14;',
						'    float baseY = 0.5 + i * 0.02;',
						'    float dist = length(vec2(uv.x - mx, baseY - my));',
						'    bend = 0.1 * exp(-dist * 2.5);',
						'    float y = baseY + wave(uv.x, 1.5 + i * 0.4, 0.3 + i * 0.07, 0.04 + i * 0.006, phase) + bend;',
						'    float l = line(uv, y, 0.005 - i * 0.0003);',
						'    float fade = smoothstep(0.0, 0.25, uv.x) * smoothstep(aspect, aspect - 0.25, uv.x);',
						'    col += c2 * l * baseAlpha * fade * (1.0 - i * 0.12);',
						'  }',

						// Bottom wave group
						'  for (float i = 0.0; i < 4.0; i++) {',
						'    float phase = i * 1.5 + 1.57;',
						'    float baseY = 0.25 + i * 0.03;',
						'    float dist = length(vec2(uv.x - mx, baseY - my));',
						'    bend = 0.07 * exp(-dist * 3.5);',
						'    float y = baseY + wave(uv.x, 2.5 + i * 0.2, 0.5 + i * 0.04, 0.025 + i * 0.004, phase) + bend;',
						'    float l = line(uv, y, 0.003 - i * 0.0003);',
						'    float fade = smoothstep(0.0, 0.35, uv.x) * smoothstep(aspect, aspect - 0.35, uv.x);',
						'    col += c3 * l * baseAlpha * fade * (1.0 - i * 0.18);',
						'  }',

						// Subtle vignette
						'  float vig = 1.0 - 0.3 * length((gl_FragCoord.xy / u_resolution - 0.5) * 1.2);',
						'  col *= vig;',

						'  gl_FragColor = vec4(col, 1.0);',
						'}'
					].join('\n');

					function createShader(type, src) {
						var s = gl.createShader(type);
						gl.shaderSource(s, src);
						gl.compileShader(s);
						if (!gl.getShaderParameter(s, gl.COMPILE_STATUS)) {
							console.warn('Shader error:', gl.getShaderInfoLog(s));
							gl.deleteShader(s);
							return null;
						}
						return s;
					}

					var vs = createShader(gl.VERTEX_SHADER, vertSrc);
					var fs = createShader(gl.FRAGMENT_SHADER, fragSrc);
					if (!vs || !fs) return;

					var prog = gl.createProgram();
					gl.attachShader(prog, vs);
					gl.attachShader(prog, fs);
					gl.linkProgram(prog);
					if (!gl.getProgramParameter(prog, gl.LINK_STATUS)) return;
					gl.useProgram(prog);

					// Fullscreen quad
					var buf = gl.createBuffer();
					gl.bindBuffer(gl.ARRAY_BUFFER, buf);
					gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([-1,-1, 1,-1, -1,1, 1,1]), gl.STATIC_DRAW);
					var pos = gl.getAttribLocation(prog, 'a_position');
					gl.enableVertexAttribArray(pos);
					gl.vertexAttribPointer(pos, 2, gl.FLOAT, false, 0, 0);

					// Uniforms
					var uTime = gl.getUniformLocation(prog, 'u_time');
					var uRes = gl.getUniformLocation(prog, 'u_resolution');
					var uMouse = gl.getUniformLocation(prog, 'u_mouse');
					var uDark = gl.getUniformLocation(prog, 'u_isDark');

					var start = performance.now();
					var animId;

					function render() {
						var t = (performance.now() - start) / 1000;
						gl.uniform1f(uTime, t);
						gl.uniform2f(uRes, canvas.width, canvas.height);
						gl.uniform2f(uMouse, mouse.x, mouse.y);
						gl.uniform1f(uDark, isDark ? 1.0 : 0.0);
						gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);
						animId = requestAnimationFrame(render);
					}
					render();

					// Expose cleanup for layout.svelte
					window.__loaderCleanup = function() {
						cancelAnimationFrame(animId);
						window.removeEventListener('resize', resize);
						gl.deleteProgram(prog);
						gl.deleteShader(vs);
						gl.deleteShader(fs);
						gl.deleteBuffer(buf);
						var ext = gl.getExtension('WEBGL_lose_context');
						if (ext) ext.loseContext();
					};
				})();
			</script>
		</div>
		<div id="app-root" style="display: contents; visibility: hidden;">%sveltekit.body%</div>
	</body>
</html>
